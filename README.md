# Demo App (Flutter Eâ€‘Commerce)

A feature-rich Flutter application for browsing products, authenticating with email/password or Google, managing carts, and completing checkout flows. The app integrates with a custom REST backend plus Firebase (Auth, Cloud Messaging) and delivers local notifications for order confirmations.

## Features

- Email/password login against `https://ecommerce.atithyahms.com` (see `lib/login_page.dart`).
- Google Sign-In via Firebase Auth with backend token exchange (`lib/core/services/google_sign_in_service.dart`).
- Product grid, detail pages, cart and checkout flows, profile, address book, order history/tracking, and password reset screens under `lib/pages/`.
- Firebase Cloud Messaging foreground/background handlers (`lib/core/services/fcm_service.dart`).
- Local notifications for order placement and foreground FCM messages using `flutter_local_notifications` (`lib/core/services/notification_service.dart`).
- Android/iOS builds configured through Kotlin DSL Gradle files with desugaring enabled and Firebase plugins applied.

## Requirements

- Flutter 3.24+ with Dart SDK â‰¥ 3.9.2 (per `environment.sdk`).
- Android Studio / Xcode CLIs for platform builds.
- Firebase project with at least an Android app configured for `com.example.demo_app`.
- Access to the e-commerce backend endpoints already referenced in the code.

## Project Structure

- `lib/main.dart` â€“ application entry point, theming, routing, Firebase + notification bootstrap.
- `lib/pages/` â€“ UI screens (login, signup, checkout, order history, etc.).
- `lib/core/services/` â€“ shared logic: authentication persistence, Google sign-in, Firebase Messaging, local notifications, and other utilities.
- `assets/` â€“ background artwork and icons registered under `flutter.assets`.
- `android/`, `ios/`, `web/`, etc. â€“ platform-specific host projects generated by Flutter.

## Getting Started

```bash
git clone <repo-url>
cd demo_app
flutter pub get
```

1. **Configure Firebase**
	- Place your Android `google-services.json` inside `android/app/` (already present for `com.example.demo_app`).
	- Optional: add `GoogleService-Info.plist` under `ios/Runner/` for iOS builds.
	- Install FlutterFire CLI and regenerate configs whenever you add/remove Firebase apps:
	  ```bash
	  dart pub global activate flutterfire_cli
	  flutterfire configure
	  ```
2. **Run the app**
	```bash
	flutter run                # debug build on device/emulator
	flutter run --release      # release profile
	```

## Firebase + Google Sign-In

1. `lib/firebase_options.dart` is generated from Firebase via `flutterfire configure`. Rerun the command after adding iOS/web/desktop apps or rotating keys.
2. Android already applies `com.google.gms.google-services` inside `android/app/build.gradle.kts`. If you rename the applicationId or update SHA-1 fingerprints, download a fresh `google-services.json`.
3. For iOS/macOS, add the `.plist`, run `pod install` inside `ios/`, and rerun the FlutterFire CLI.
4. `main()` initializes Firebase, registers the FCM background handler, then boots `NotificationService` and `FcmService`. Google Sign-In goes through Firebase Auth, then `GoogleSignInService` POSTs the profile to `/api/v2/ecommerce/customer/google/login` to obtain the API token saved via `AuthService`.
5. Testing: run `flutter run`, use the Google button on the login page, approve the consent screen, and confirm that navigation reaches `/home`. Inspect `flutter logs` for backend responses if issues appear.

## Push & Local Notifications

1. Dependencies: `firebase_messaging`, `firebase_core`, `flutter_local_notifications`, and Android `coreLibraryDesugaring` are already declared (see `pubspec.yaml` and `android/app/build.gradle.kts`). Run `flutter pub get` after edits.
2. Android manifest includes `POST_NOTIFICATIONS`; Android 13+ still prompts the user at runtime. iOS permission prompts are handled through `FirebaseMessaging.requestPermission` in `FcmService`.
3. `FcmService` registers handlers for foreground/background/terminated messages and displays a local notification whenever a push arrives in the foreground.
4. `NotificationService` creates the `order_updates` channel and exposes `showOrderPlacedNotification`, triggered from `lib/pages/checkout_page.dart` when the backend confirms an order. A generic `showSimpleNotification` helper powers other alerts.
5. Testing: send a message from Firebase console â†’ Cloud Messaging and use the printed FCM token. Foreground pushes should show a heads-up notification; background/terminated pushes use system trays.

## Building & QA

- **Analyzer**: `dart analyze` (current warnings stem from deprecated `withOpacity` usage and a missing `flutter_lints` includeâ€”logically tracked for future cleanup).
- **Tests**: `flutter test` (expand beyond the sample widget test as needed).
- **Android release**: `flutter build apk`. If Kotlin incremental cache errors occur, run `flutter clean` and retry.
- **iOS release**: `flutter build ipa` after running `pod install` in `ios/`.

## Troubleshooting

- Google sign-in loops usually mean mismatched SHA-1 fingerprints in Firebase.
- Missing FCM notifications â†’ verify the OS-level notification permission toggle and check `flutter logs` for `ðŸ“² FCM token` output.
- Local notifications suppressed â†’ confirm the `order_updates` channel isnâ€™t disabled in Android system settings.
- Gradle `google-services` plugin complaints â†’ ensure the plugin is declared in the `plugins {}` block instead of Groovyâ€™s `apply plugin` syntax.

## Roadmap

- Replace deprecated `withOpacity` usages with `Color.withValues`.
- Sync FCM tokens with the backend inside `FcmService._persistToken`.
- Add integration tests that cover checkout, notification display, and auth flows.

Feel free to adapt the UI, assets, or backend endpoints to match your brand.
